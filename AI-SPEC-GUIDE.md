# 📚 AI 回复规范 - 使用指南

## 🎯 文档说明

本目录包含 3 个核心文档，定义了工业级的 AI 回复规范和测试体系：

### 1. AI-REPLY-STANDARD.md
**AI 回复规范 v1.0** - 定义回复的质量标准、结构要求、评分标准

### 2. AI-PROMPT-TEMPLATES.md
**AI 提示词模板 v1.0** - System Prompt 和 User Prompt 模板

### 3. AI-TESTING-FRAMEWORK.md
**测试框架 v1.0** - 测试用例、评分系统、质量指标

---

## 🚀 快速开始

### 第 1 步：了解规范

阅读 `AI-REPLY-STANDARD.md`，了解：
- ✅ 回复必须包含的 6 个部分
- ✅ 质量标准（长度、格式、准确性）
- ✅ 不同场景的回复策略
- ❌ 禁止事项

### 第 2 步：更新提示词

将 `AI-PROMPT-TEMPLATES.md` 中的模板应用到 `ai-service/ai-service.js`：

```javascript
buildPrompt(question, mcpContext = '') {
  // 使用新的模板...
}
```

### 第 3 步：运行测试

```bash
cd ai-service
node run-tests.js
```

查看输出：
```
🎯 LayaAir AI 回复质量测试
🧪 测试用例: TC001
   问题: 如何创建 Sprite 精灵？
   类型: basic
...
📊 测试报告
   ✅ 通过: 8 (80%)
   平均分: 82.5
```

### 第 4 步：优化迭代

根据测试结果调整提示词，重新运行测试，直到通过率 ≥ 95%。

---

## 📊 评分标准

### 自动评分（100 分）

| 项目 | 分数 | 说明 |
|------|------|------|
| 结构完整性 | 30 | 必须包含 6 个部分 |
| 长度 | 10 | 800-1500 字符优秀 |
| 文档链接 | 15 | 必须使用官方链接 |
| 完整性 | 20 | 不能中途截断 |
| 代码示例 | 25 | 必须完整可运行 |

### 人工评分（90 分）

| 项目 | 分数 | 说明 |
|------|------|------|
| 准确性 | 40 | 代码能运行，概念正确 |
| 实用性 | 30 | 解释清晰，有实用价值 |
| 可读性 | 20 | 格式规范，语言流畅 |

### 及格线
- 总分 190 分（满分）
- 及格: 76 分（40%）
- 优秀: 133 分（70%）

---

## 🧪 测试用例

当前包含 11 个测试用例：

### 基础功能（3 个）
- TC001: Sprite 创建
- TC002: Scene3D 创建
- TC003: 事件监听

### 中级功能（2 个）
- TC101: 骨骼动画
- TC102: 物理引擎

### 高级功能（2 个）
- TC201: IK 反向运动学
- TC202: Shader 编程

### 边界情况（3 个）
- TC301: 版本迁移
- TC302: 模糊问题
- TC303: 错误假设

---

## 🔄 持续优化流程

### 每次代码修改后
```bash
# 1. 运行测试
node run-tests.js

# 2. 查看报告
cat /tmp/ai-test-report-*.json

# 3. 分析失败用例
# 手动检查为什么不及格

# 4. 调整提示词
# 编辑 ai-service.js

# 5. 重新测试
```

### 每周质量检查
```bash
# 随机抽取历史回复
# 人工评分
# 生成质量报告
# 对比上周数据
```

---

## 📈 质量目标

### 短期（1-2 周）
- [ ] 实现自动评分系统 ✅
- [ ] 建立测试用例库（11 个）✅
- [ ] 平均分达到 80 分

### 中期（1 个月）
- [ ] 平均分达到 85 分
- [ ] 及格率达到 95%
- [ ] 截断率 < 3%

### 长期（3 个月）
- [ ] 平均分达到 90 分
- [ ] 建立自动优化机制
- [ ] 支持自适应提示词

---

## 💡 常见问题

### Q1: 为什么 IK 问题只要求 50 分及格？
**A**: 因为 MCP 返回的 IK 文档有限（只有 19 字符），无法生成详细回答。这是预期行为。

### Q2: 如何调整某个测试的及格线？
**A**: 编辑 `test-cases.js`，修改 `passLine` 字段：
```javascript
{
  id: 'TC201',
  passLine: 60,  // 调整这个值
  ...
}
```

### Q3: 如何添加新的测试用例？
**A**: 在 `test-cases.js` 中添加新对象：
```javascript
{
  id: 'TC004',
  type: 'basic',
  question: '你的问题',
  useMCP: true,
  passLine: 75
}
```

### Q4: 如何调整评分权重？
**A**: 编辑 `test-reply-quality.js` 中的评分方法：
```javascript
checkStructure(content) {
  let score = 0;
  if (content.includes('## 问题分析')) score += 5;  // 调整权重
  ...
}
```

---

## 📞 支持

如有问题或建议，请：
1. 查看 3 个核心文档
2. 运行测试查看结果
3. 根据反馈调整规范

---

**版本**: v1.0
**最后更新**: 2026-02-26
**维护者**: LayaAir AI Team
