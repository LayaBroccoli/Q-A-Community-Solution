ğŸ”§ **AIè¯„åˆ†ç³»ç»Ÿ - æœ€ç®€åŒ–ç‰ˆï¼ˆä¸ä¾èµ–appå¯¹è±¡ï¼‰**

**å®Œæ•´ä»£ç ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´**

=======================================
ä»£ç å¼€å§‹
=======================================*/

<script>
(function() {
  console.log('[AIè¯„åˆ†] å¯åŠ¨ï¼ˆæœ€ç®€åŒ–ç‰ˆï¼‰');

  const CONFIG = {
    apiBaseUrl: 'http://43.128.56.125:8080/proxy-rating',
    aiUsername: 'AIåŠ©æ‰‹'
  };

  function addRatingBox() {
    document.querySelectorAll('article.CommentPost.Post').forEach(function(post) {
      if (post.querySelector('.ai-rating-box')) return;

      const username = post.querySelector('.username');
      if (!username || username.textContent.trim() !== CONFIG.aiUsername) return;

      const container = post.closest('[data-id]');
      const postId = container?.dataset?.id;
      if (!postId) return;

      console.log('âœ… æ‰¾åˆ°AIå›å¤ï¼Œå¸–å­ID:', postId);

      const box = document.createElement('div');
      box.innerHTML =
        '<div style="margin-top:15px;padding:15px;background:#f8f9fa;border-radius:8px;border:1px solid #e0e0e0">' +
          '<div style="font-size:14px;font-weight:600;margin-bottom:10px">ğŸ“Š è¿™ä¸ªå›ç­”æœ‰å¸®åŠ©å—ï¼Ÿ</div>' +
          '<div style="display:flex;gap:8px">' +
            '<button onclick="window.submitAIRating(this,' + postId + ',\'helpful\')" style="flex:1;padding:10px;border:2px solid #ddd;border-radius:8px;background:#fff;cursor:pointer">âœ… è§£å†³</button>' +
            '<button onclick="window.submitAIRating(this,' + postId + ',\'partial\')" style="flex:1;padding:10px;border:2px solid #ddd;border-radius:8px;background:#fff;cursor:pointer">âš ï¸ éƒ¨åˆ†</button>' +
            '<button onclick="window.submitAIRating(this,' + postId + ',\'not_helpful\')" style="flex:1;padding:10px;border:2px solid #ddd;border-radius:8px;background:#fff;cursor:pointer">âŒ æœªè§£å†³</button>' +
            '<button onclick="window.submitAIRating(this,' + postId + ',\'irrelevant\')" style="flex:1;padding:10px;border:2px solid #ddd;border-radius:8px;background:#fff;cursor:pointer">ğŸ¤” ä¸ç›¸å…³</button>' +
          '</div>' +
          '<div class="feedback" style="margin-top:10px;font-size:13px;color:#666"></div>' +
        '</div>';

      post.querySelector('.Post-body')?.appendChild(box);
      console.log('âœ… è¯„åˆ†æ¡†å·²æ·»åŠ ');
    });
  }

  // å…¨å±€å‡½æ•°ï¼Œä¸ä¾èµ–é—­åŒ…
  window.submitAIRating = function(btn, postId, rating) {
    const box = btn.closest('.ai-rating-box') || btn.parentElement.parentElement;
    const feedback = box.querySelector('.feedback');
    const buttons = box.querySelectorAll('button');

    buttons.forEach(b => b.disabled = true);
    feedback.textContent = 'æäº¤ä¸­...';

    console.log('=== æäº¤è¯„åˆ† ===');
    console.log('å¸–å­ID:', postId, 'ç±»å‹:', typeof postId);
    console.log('è¯„åˆ†:', rating, 'ç±»å‹:', typeof rating);

    const requestData = {
      post_id: parseInt(postId),
      rating: rating
    };

    console.log('è¯·æ±‚æ•°æ®:', requestData);

    fetch(CONFIG.apiBaseUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(requestData)
    })
    .then(res => {
      console.log('å“åº”çŠ¶æ€:', res.status);
      return res.json();
    })
    .then(data => {
      console.log('å“åº”æ•°æ®:', data);
      if (data.success) {
        feedback.textContent = 'âœ… æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼';
        feedback.style.color = '#4caf50';
        btn.style.opacity = '0.6';
      } else {
        feedback.textContent = 'âŒ ' + data.error;
        feedback.style.color = '#f44336';
        buttons.forEach(b => b.disabled = false);
      }
    })
    .catch(err => {
      console.error('é”™è¯¯:', err);
      feedback.textContent = 'âŒ é”™è¯¯: ' + err.message;
      feedback.style.color = '#f44336';
      buttons.forEach(b => b.disabled = false);
    });
  };

  addRatingBox();
  new MutationObserver(addRatingBox).observe(document.body, { childList: true, subtree: true });

  console.log('[AIè¯„åˆ†] å¯åŠ¨å®Œæˆ');
})();
</script>

=======================================
ä»£ç ç»“æŸ
=======================================*/

## ğŸ“ å…³é”®æ”¹è¿›

1. **ç§»é™¤äº†æ‰€æœ‰å¯èƒ½ä¸ºnullçš„å‚æ•°**
   - âŒ ä¸å†å‘é€ discussion_id
   - âŒ ä¸å†å‘é€ user_id
   - âœ… åªå‘é€å¿…éœ€çš„ post_id å’Œ rating

2. **ä½¿ç”¨å…¨å±€å‡½æ•°**
   - `window.submitAIRating` å¯ä»¥ä»ä»»ä½•åœ°æ–¹è°ƒç”¨
   - ä¸ä¾èµ–é—­åŒ…å’Œappå¯¹è±¡

3. **è¯¦ç»†çš„Consoleæ—¥å¿—**
   - æ˜¾ç¤ºå¸–å­IDå’Œç±»å‹
   - æ˜¾ç¤ºè¯„åˆ†ç±»å‹
   - æ˜¾ç¤ºå®Œæ•´è¯·æ±‚å’Œå“åº”

---

## ğŸš€ æ“ä½œæ­¥éª¤

1. Flarum Admin â†’ Appearance â†’ Custom Header
2. åˆ é™¤æ‰€æœ‰æ—§ä»£ç 
3. ç²˜è´´ä¸Šé¢çš„å®Œæ•´ä»£ç 
4. Save Changes
5. åˆ·æ–°è®ºå›é¡µé¢
6. ç‚¹å‡»è¯„åˆ†æŒ‰é’®
7. **æŠŠConsoleè¾“å‡ºå¤åˆ¶ç»™æˆ‘ï¼**

---

**è¿™æ¬¡åº”è¯¥èƒ½æˆåŠŸäº†ï¼** ğŸ‰

**å¦‚æœè¿˜æœ‰é—®é¢˜ï¼ŒConsoleæ—¥å¿—ä¼šå‘Šè¯‰æˆ‘ä»¬å“ªé‡Œå‡ºé”™** ğŸ”
