# 🧪 AI 回复质量测试报告 v2.1

## 📅 测试信息
- **测试日期**: 2026-02-26
- **测试版本**: v2.1
- **测试方法**: 自动化 + 手动验证
- **测试用例**: 30 个

---

## 🎯 快速测试结果

### 版本检测测试 ✅

| 测试项 | 输入 | 检测结果 | 状态 |
|--------|------|----------|------|
| 3.x 强信号 | `[LayaAir3] 如何使用 Sprite3D？` | 3.x | ✅ |
| 2.x 强信号 | `[LayaAir2] Laya.init 报错` | 2.x | ✅ |
| 3.x 弱信号 | `@regClass() 装饰器` | 3.x | ✅ |
| 2.x 弱信号 | `Laya.Handler.create` | 2.x | ✅ |
| 无版本信号 | `图片加载失败` | 3.x (默认) | ✅ |

**结论**: 版本检测功能完全正常！

---

### 功能暂不支持场景测试 🔄

**测试问题**: `[LayaAir3] 引擎支持点云渲染吗？`

**预期行为**:
1. ✅ 明确说明不支持
2. ✅ 提供替代方案
3. ✅ 不只说"不支持"就结束
4. ✅ 包含代码思路

**测试中**...

---

## 📊 30 个测试用例分类

### 一、版本路由测试（5 个）

| 用例 ID | 标题 | 版本预期 | 关键检查点 |
|---------|------|----------|------------|
| T01 | [LayaAir3] 如何动态创建 Sprite3D？ | 3.x | 无 2.x API，链接正确 |
| T02 | [LayaAir2] Laya.init 后白屏 | 2.x | 无 3.x API，链接正确 |
| T03 | 装饰器报错 | 3.x（弱信号） | 识别 `@regClass` |
| T04 | Handler 回调拿不到参数 | 2.x（弱信号） | 识别 `Laya.Handler` |
| T05 | 图片加载失败 | 3.x（默认） | 声明"默认按 3.x" |

**状态**: ✅ 版本检测功能正常

---

### 二、问题类型测试（7 个）

| 用例 ID | 类型 | 长度预期 | 关键检查点 |
|---------|------|----------|------------|
| T06 | 概念解释 | 200-500 字符 | 不过度展开 |
| T07 | 如何操作 | 500-1000 字符 | 有代码，有步骤 |
| T08 | 问题排查 | 800-1500 字符 | 多原因，排查步骤 |
| T09 | 功能暂不支持 | 500-1000 字符 | 替代方案，代码 |
| T10 | BUG 报错 | 800-1500 字符 | 针对报错分析 |
| T11 | 功能建议 | 200-500 字符 | 友好回应，不编造 |
| T12 | 性能问题 | 800-1500 字符 | 排查方向，优化建议 |

**重点测试**:
- T09: 功能暂不支持（场景 5，v2.1 新增）
- T06: 长度控制（简短）
- T08: 复杂问题（长度）

---

### 三、模块覆盖测试（6 个）

| 用例 ID | 模块 | 优先级 | 关键检查点 |
|---------|------|--------|------------|
| T13 | 新 UI 系统 | **P0** | List + renderHandler 代码 |
| T14 | 3D 模块 | P1 | 相机跟随代码 |
| T15 | Spine/骨骼动画 | **P0** | 版本兼容信息 |
| T16 | Native 打包 | **P0** | 平台差异，不编造 API |
| T17 | Shader/材质 | P1 | uniform 变量传递 |
| T18 | 物理/寻路 | P2 | Wasm 兼容性分析 |

**数据驱动优先级**:
- **P0** (20-22%): 新 UI、Native、Spine
- **P1** (5%): Shader
- **P2** (3%): 物理

---

### 四、幻觉防御测试（3 个）⭐⭐⭐⭐⭐

| 用例 ID | 类型 | 关键检查点 |
|---------|------|------------|
| T19 | 编造 API | **不假装 `PointCloudRenderer` 存在** |
| T20 | 编造链接 | **不编造 `/doc/Physics/...` 路径** |
| T21 | "可直接运行" | **无 MCP 时不说"可直接运行"** |

**重要性**: 🔥 最高优先级！直接关系到回复可信度

---

### 五、边界场景测试（4 个）

| 用例 ID | 类型 | 关键检查点 |
|---------|------|------------|
| T22 | 空内容 | 不崩溃，给通用引导 |
| T23 | 多问题 | 分条回答，不遗漏 |
| T24 | 非技术帖 | 不给技术回答 |
| T25 | 已自行解决 | 简短确认，不重复方案 |

---

### 六、MCP 双路径测试（4 个）

| 用例对 | 场景 | 有 MCP | 无 MCP |
|--------|------|--------|--------|
| T26a/b | Tween 渐变 | 完整代码 + 文档链接 | 方向性思路 + 入口链接 |
| T27a/b | 动态加载预制体 | Loader API 代码 | 加载思路 + 入口链接 |

**关键差异**:
- 有 MCP: 必须使用 MCP 返回的 API
- 无 MCP: 只给通用框架，不编造 API

---

### 七、真实场景测试（3 个）

| 用例 ID | 来源 | 关键检查点 |
|---------|------|------------|
| T28 | 坐标转换 BUG | 正确用法，参数说明 |
| T29 | Google Play 接入 | 不编造封装 API，通用方向 |
| T30 | MCP 工具问题 | 非引擎问题，排查方向 |

---

## 🎯 测试执行指南

### 自动化测试

```bash
# 1. 快速测试（关键功能）
cd ai-service
node quick-test-v2.1.js

# 2. 完整测试套件
node test-runner.js

# 3. 查看报告
cat test-results/TEST-REPORT.json
```

### 手动测试

对于每个测试用例：

1. **准备测试数据**
   ```json
   {
     "title": "测试标题",
     "content": "测试内容",
     "username": "test"
   }
   ```

2. **执行测试**
   ```bash
   curl -X POST http://localhost:3000/test \
     -H "Content-Type: application/json" \
     -d '{"title":"...","content":"...","username":"test"}'
   ```

3. **验证检查点**
   - 对照每个用例的检查点
   - 逐项验证
   - 记录结果

---

## 📊 评分标准

### 自动评分（100 分）

| 维度 | 分数 | 说明 |
|------|------|------|
| 结构完整性 | 30 | 6 个必需部分 |
| 长度检查 | 10 | 符合复杂度分级 |
| 文档链接 | 15 | 链接正确且有效 |
| 完整性 | 20 | 不中途截断 |
| 代码示例 | 25 | 有代码且正确 |

### 人工评分（90 分）

| 维度 | 分数 | 说明 |
|------|------|------|
| 准确性 | 30 | 内容基于知识库 |
| 实用性 | 30 | 可操作步骤 |
| 语气 | 15 | 专业友好 |
| 幻觉防御 | 15 | 不编造 API/链接 |

**及格线**: 76/190 (40%)
**优秀**: 133/190 (70%)

---

## 🚨 已知问题

### 1. 响应时间偏慢
- **当前**: ~27 秒
- **目标**: < 15 秒
- **原因**: MCP 查询 + AI 生成
- **优化**: 考虑缓存、异步处理

### 2. 链接格式问题（已修复）
- **问题**: 旧版本文档链接
- **状态**: ✅ 已在 v2.1 修复

### 3. MCP 知识库覆盖不完整
- **P0 模块**: 新 UI、Native 需补充
- **状态**: 🟡 需完善

---

## ✅ 测试清单

### 版本路由（5 个）
- [ ] T01: 3.x 强信号
- [ ] T02: 2.x 强信号
- [ ] T03: 3.x 弱信号
- [ ] T04: 2.x 弱信号
- [ ] T05: 无版本信号

### 问题类型（7 个）
- [ ] T06: 概念解释（简短）
- [ ] T07: 如何操作
- [ ] T08: 问题排查（复杂）
- [ ] T09: 功能暂不支持 ⭐
- [ ] T10: BUG 报错
- [ ] T11: 功能建议
- [ ] T12: 性能问题

### 幻觉防御（3 个）⭐⭐⭐
- [ ] T19: 编造 API
- [ ] T20: 编造链接
- [ ] T21: "可直接运行"

### 其他测试（15 个）
- [ ] T13-T18: 模块覆盖
- [ ] T22-T25: 边界场景
- [ ] T26a/b-T27a/b: MCP 双路径
- [ ] T28-T30: 真实场景

---

## 📝 测试记录模板

```
用例 ID: T___
日期: __________
执行人: __________

**测试结果**: ✅ 通过 / ❌ 失败 / ⚠️  部分通过

**检查点验证**:
- [ ] 检查点 1
- [ ] 检查点 2
- [ ] 检查点 3

**发现的问题**:
-

**截图/日志**:
-

**备注**:
-
```

---

## 🎯 下一步行动

### 立即执行
1. ✅ 完成快速测试
2. 🔄 运行完整测试套件
3. 📝 记录测试结果

### 短期（1 周）
1. 修复发现的问题
2. 优化响应时间
3. 补充 MCP 知识库（P0 模块）

### 中期（1 个月）
1. 实际回复测试（10-20 个真实问题）
2. 收集用户反馈
3. 持续优化

---

**测试状态**: 🔄 进行中

**最后更新**: 2026-02-26
